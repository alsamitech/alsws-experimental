Debug functions adapted from Jacob Sorber
